// This is your Prisma schema file for Appointment Management Service
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum AppointmentStatus {
  Pending
  Confirmed
  Completed
  Cancelled
}

enum Gender {
  Male
  Female
  Other
}

enum BookingType {
  Self // Đặt cho bản thân
  Relative // Đặt cho người thân
}

enum PaymentStatus {
  Unpaid // Chưa thanh toán
  Paid // Đã thanh toán
}

enum PaymentMethod {
  Cash // Tiền mặt
  BankTransfer // Chuyển khoản
}

// Main Appointment model
model Appointment {
  id String @id @default(uuid()) @map("appointment_id")

  // References to other services
  userId      String @map("user_id") @db.VarChar(255)
  doctorId    String @map("doctor_id") @db.VarChar(255)// Reference to doctor_service
  clinicId    Int    @map("clinic_id") // Reference to doctor_service
  specialtyId Int    @map("specialty_id") // Reference to doctor_service
  scheduleId  String @map("schedule_id") @db.VarChar(255) // Reference to doctor_service
  timeSlotId  Int    @map("time_slot_id") // Reference to doctor_service

  // Appointment details
  appointmentDate DateTime          @map("appointment_date") @db.Date
  appointmentTime DateTime          @map("appointment_time") @db.Time
  status          AppointmentStatus @default(Pending)
  bookingType     BookingType       @map("booking_type")

  // Thông tin người khám bệnh (bệnh nhân thực tế)
  patientName        String   @map("patient_name") @db.VarChar(255)
  patientPhone       String   @map("patient_phone") @db.VarChar(20)
  patientEmail       String?  @map("patient_email") @db.VarChar(255)
  patientGender      Gender   @map("patient_gender")
  patientDateOfBirth DateTime @map("patient_date_of_birth") @db.Date

  // Địa chỉ người khám bệnh
  patientCity     String @map("patient_city") @db.VarChar(100)
  patientDistrict String @map("patient_district") @db.VarChar(100)
  patientAddress  String @map("patient_address") @db.Text

  // Thông tin người đặt lịch (chỉ có khi bookingType = Relative)
  bookerName  String? @map("booker_name") @db.VarChar(255) // Tên người đặt
  bookerPhone String? @map("booker_phone") @db.VarChar(20) // SĐT người đặt
  reason      String? @map("reason") @db.Text

  // Financial information (snapshot from doctor_service fees)
  feeId         Int            @map("fee_id") // Reference to doctor_service fees table
  bookingFee    Decimal        @default(0.00) @map("booking_fee") @db.Decimal(10, 2)
  totalFee      Decimal        @default(0.00) @map("total_fee") @db.Decimal(10, 2)
  paymentStatus PaymentStatus  @default(Unpaid) @map("payment_status")
  paymentMethod PaymentMethod? @map("payment_method")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("appointments")
}
